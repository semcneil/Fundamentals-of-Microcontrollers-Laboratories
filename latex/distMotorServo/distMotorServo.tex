\chapter{Distance, Motor, Servo}
\chaplabel{distMotorServo}

\section{Purpose}
The goal of this lab is to learn the distance sensor, driving DC motors, and driving 
servo motors.

\section{Main Requirements}
\subsection{Distance Calibration}
Using an example sketch for the distance sensor, create a calibration curve for the distance 
sensor out to it's maximum sensing distance using the lid of the shoebox as a target. The 
calibration curve should use at least 5 points and have the readout (0-255ish) on the x-axis
and actual, measured distance on the y-axis. It is fastest to just print the distances out and 
then record them onto another document rather than trying to save them off to the SD card.
Plot the calibration curve in your favorite data analysis software (Python, Matlab, Excel, etc.). 
Use the Pololu library for the VL6180 sensor and set SCALING to 1 for this part of the assignment.
Set SCALING to 3 for everything else.

\subsection{DC Motors}
Write a sketch that drives your robot forward until the distance sensor senses something 
(you choose a reasonable threshold), and then turns to avoid it and continues on. Remember
that to drive the motors at different speeds, you can just use \lstinline@analogWrite@ on 
one pin and set the other pin to 0 (\lstinline@analogWrite(0)@). In order for the motor to 
actually spin, the number passed to \lstinline@analogWrite@ needs to be greater than 50. 
The motor pins are listed as \lstinline@AIN1, AIN2, BIN1, BIN2@ which map to 0, 1, 8, 
and A2, respectively, on the schematic. Do not mix \lstinline@analogWrite@ and 
\lstinline@digitalWrite@ on the same pin in the same program.

Also, make sure that the motor jumpers are set to bat, not +5V. This makes it so that 
the big power switch has to be in the ON position for the motors to run. Be sure to 
switch it on when you want the motors running. 

Lastly, be sure to do this with SCALING set to 3 so that the detection distance can 
be longer.

\subsection{Servo}
Write a sketch where the distance is measured every 10~degrees of servo movement. Plot the
data on the robot's TFT display. The plot can either be cartesian, with the x-axis as angle
from 0 to 180 and the y-axis the distance measured at the angle, or it can be a polar plot 
with the angle being theta, and the distance as the radius. The \lstinline@Servo@ library 
is already installed and not far down in the Examples. Look at the Sweep example to get started.

Make sure that you orient the display so that the closer distances are displayed toward the bottom of the 
screen and the further ones are towards the top. The top is defined as the side closest to the 
distance sensor.

% \section{Procedure}
% It is best to follow this outline to finish this lab most efficiently.
% \begin{enumerate}
%     \item 
% \end{enumerate}

\section{Turn In}
Turn in the following:
\begin{enumerate}
    \item Have either the TA or the instructor sign-off on your lab
    \item A PDF of your sketches.
    \item .ino versions of your sketches.
    \item The script/file you used to plot the data.
    \item Fill out the end of lab quiz prior to leaving. Note that it includes asking you 
            for the output of the \lstinline$getIDs$ sketch. 
\end{enumerate}

\section{Resources}\label{sec:distmotorservoresources}
\begin{enumerate}
    \item \href{https://www.st.com/resource/en/datasheet/vl6180.pdf}{VL6180 Distance sensor}
    \item \href{https://datasheet.lcsc.com/lcsc/2001060933_TMI-TMI8837_C478955.pdf}{TMI8837 Motor controller}
    \item PCB Schematic and Layout - see 
            \href{https://github.com/semcneil/Fundamentals-of-Microcontrollers-Manual}{class manual} 
            in the Arduino Startup $\rightarrow$ Schematics and PCB section
\end{enumerate}

